<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <link rel="stylesheet" href="https://ssl.gstatic.com/docs/script/css/add-ons1.css">
    <!-- The CSS package above applies Google styling to buttons and other elements. -->
    
    <style>
     
     
    .branding-below {
      bottom: 56px;
      top: 0;
    }

    .branding-text {
      left: 7px;
      position: relative;
      top: 3px;
    }

    .col-contain {
      overflow: hidden;
    }

    .col-one {
      float: left;
      width: 50%;
    }

    .logo {
      vertical-align: middle;
    }

    .radio-spacer {
      height: 20px;
    }

    .width-100 {
      width: 100%;
    }
    </style>
  </head>
  <body>
    <div class="sidebar branding-below">
    
      <form>        
        <div class="block form-group">
          <label for="doc-id">Documento con Ã­ndices</label>
          <input type="file" name="index" id="index-id" value="" >
        </div>
        
        <div class="block form-group">
          <label for="translated-text"><b>Prueba:</b></label>
          <textarea class="width-100" id="text" rows="20"></textarea>
        </div>
        
        <div class="block" id="button-bar">
          <button class="blue" id="combinar">Combinar documentos</button>
          <input type="reset" id="reset" value="Resetear formulario">
        </div>
      </form>    
    
    </div>

    <div class="sidebar bottom">
      <img alt="Add-on logo" class="logo" src="https://www.gstatic.com/images/branding/product/1x/translate_48dp.png" width="27" height="27">
      <span class="gray branding-text">By Andrea and David</span>
    </div>
    
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js">
    </script>
    
    <script>
      /**
       * On document load, assign click handlers to each button and try to load the
       * user's origin and destination language preferences if previously set.
       */
      $(function() {
        $('#combinar').click(runCombination);
      });
      
      function runCombination() {
        this.disabled = true;
        $('#error').remove();
        google.script.run
            .withSuccessHandler(
              function(msg, element) {
              
                var r1 = /\[/g;
                var r2 = /\d/;
                var r4 = /\]/;
                var r3 = new RegExp(r1.source + r2.source + r4.source, (r1.global ? 'g' : '') + (r1.ignoreCase ? 'i' : '') + (r1.multiline ? 'm' : ''));
                var solution = msg.match(r3);
                
                var i = 0;
                var charsToSearch = "";
                var duplicated = false;
                var auxArray = [];
                var cad = "";
                while(i < solution.length && !duplicated){
                
                  charsToSearch = solution[i];
                  if(auxArray.indexOf(charsToSearch) != -1){ // if indexOf returns -1, then the chars tu search exist in the solution
                    duplicated = true;
                    alert("There can not be two bibliographic references with the same expresion");
                  }
                  else{
                    auxArray[i] = solution[i];
                    cad = cad + solution[i] + "\n";
                    i++;
                  }
                }
                
                element.disabled = false;  
                
                $('#text').val(cad);
                element.disabled = false;
                
              })
            .withFailureHandler(
              function(msg, element) {
                showError(msg, $('#button-bar'));
                element.disabled = false;
              })
            .withUserObject(this)
            .getText();
      }
      
      function showError(msg, element) {
        var div = $('<div id="error" class="error">' + msg + '</div>');
        $(element).after(div);
      }
    </script>
    
  </body>
</html>


